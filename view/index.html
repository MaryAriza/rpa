<!--
*
*  INSPINIA - Responsive Admin Theme
*  version 2.8
*
-->
<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>INSPINIA | Dashboard</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <!-- Toastr style -->
    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">

    <!-- Gritter -->
    <!-- <link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet"> -->

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body class="pace-done skin-1">
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" style="margin-top: 0px;" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element">
                            <img alt="image" class="rounded-circle" src="img/profile_small.jpg" width="50" height="50"/>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <span class="block m-t-xs font-bold">Waley</span>
                                <span class="text-muted text-xs block">Searcher bot<b class="caret"></b></span>
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a class="dropdown-item" href="login.html">Salir</a></li>
                            </ul>
                        </div>
                        <div class="logo-element">
                            IN+
                        </div>
                    </li>
                    <li class="active">
                        <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">Dashboards</span></a>

                    </li>

                </ul>

            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="background: #1c84c6;">
                    <div class="navbar-header">
                        <a class="minimalize-styl-2 btn btn-primary " href="#" id="iniciar"><i class="fa fa-power-off"> Iniciar</i></a>
                        <a class="minimalize-styl-2 btn btn-danger " href="#" id="detener"><i class="fa fa-power-off"> Detener</i></a>

                    </div>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <a class="right-sidebar-toggle" style="color: white;">
                                <i class="fa fa-tasks"></i>
                            </a>
                        </li>
                        <li>
                            <a href="login.html" style="color: white;">
                                <i class="fas fa-sign-out-alt"></i>
                            </a>
                        </li>
                    </ul>

                </nav>
            </div>
            <br>
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <span class="label label-success float-right"><i class="fas fa-search"></i></span>
                                <h5>Por buscar</h5>
                            </div>
                            <div class="ibox-content">
                                <h1 class="no-margins num1 text-success">0</h1>
                                <small>Registros cargados que aun no han sido procesados</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <span class="label label-info float-right"><i class="fas fa-truck-loading"></i></span>
                                <h5>Poblados</h5>
                            </div>
                            <div class="ibox-content">
                                <h1 class="no-margins num2 text-info">0</h1>
                                <small>Registros cargados que ya fueron procesados</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <span class="label label-primary float-right"><i class="far fa-thumbs-up"></i></span>
                                <h5>Con Datos</h5>
                            </div>
                            <div class="ibox-content">
                                <h1 class="no-margins num3 text-navy">0</h1>
                                <small>Registros encontrados que poseen datos en Gacela</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <span class="label label-danger float-right"><i class="far fa-thumbs-down"></i></span>
                                <h5>Sin datos</h5>
                            </div>
                            <div class="ibox-content">
                                <h1 class="no-margins num4 text-danger">0</h1>
                                <small>Registros encontrados que no poseen datos en Gacela</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row  border-bottom white-bg dashboard-header">
                    <div class="col-md-6">
                        <div class="ibox-title">
                            <h5>Datos del proceso</h5>
                        </div>
                        <div class="ibox-content">
                            <ul class="list-group clear-list m-t">
                                <li class="list-group-item fist-item">
                                    <span class="float-right datoInicio">
                                        0
                                    </span>
                                    <span class="label label-success"><i class="far fa-clock"></i></span> Fecha de inicio
                                </li>
                                <li class="list-group-item">
                                    <span class="float-right datoPromedio">
                                        0
                                    </span>
                                    <span class="label label-info"><i class="fas fa-chart-area"></i></span> Promedio de tiempo por registro
                                </li>
                                <li class="list-group-item">
                                    <span class="float-right datoTrabajo">
                                        0
                                    </span>
                                    <span class="label label-primary "><i class="fas fa-stopwatch"></i></span> Tiempo de trabajo
                                </li>
                                <li class="list-group-item">
                                    <span class="float-right bg-gray datoErrores">
                                        0
                                    </span>
                                    <span class="label label-danger"><i class="fas fa-bug"></i></span> Errores durante esta ejecuci√≥n
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>Tiempo de registros</h5>
                            </div>
                            <div class="ibox-content">
                                <div class="flot-chart">
                                    <div class="flot-chart-content" id="flot-line-chart-moving"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <div class="float-right">
                    10GB of <strong>250GB</strong> Free.
                </div>
                <div>
                    <strong>Copyright</strong> Departamento de Desarrollo Grupo Novus LTDA &copy; 2019
                </div>
            </div>
        </div>

        <div id="right-sidebar" class="animated">
            <div class="sidebar-container">

                <ul class="nav nav-tabs navs-2">
                    <li>
                        <a class="nav-link active" data-toggle="tab" href="#tab-2"><i class="fas fa-bug"></i> Errores </a>
                    </li>
                    <li>
                        <a class="nav-link" data-toggle="tab" href="#tab-3"> Registros </a>
                    </li>
                </ul>

                <div class="tab-content">

                    <div id="tab-2" class="tab-pane active">

                        <div class="sidebar-title">
                            <h3>  Lista de Errores</h3>
                        </div>

                        <ul class="sidebar-list" id="error_list">

                        </ul>

                    </div>

                    <div id="tab-3" class="tab-pane">

                        <div class="sidebar-title">
                            <h3><i class="far fa-calendar-alt"></i> Ejecuciones anteriores del bot</h3>
                            <small><i class="fas fa-chevron-right"></i> Realizadas: <b id="cant_ej">0</b> </small>
                        </div>

                        <ul class="sidebar-list" id="reg_list">

                        </ul>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Flot -->
    <script src="js/plugins/flot/jquery.flot.js"></script>
    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="js/plugins/flot/jquery.flot.pie.js"></script>

    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>
    <script src="js/demo/peity-demo.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- jQuery UI -->
    <script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- GITTER -->
    <script src="js/plugins/gritter/jquery.gritter.min.js"></script>

    <!-- Sparkline -->
    <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!-- Sparkline demo data  -->
    <script src="js/demo/sparkline-demo.js"></script>

    <!-- ChartJS-->
    <script src="js/plugins/chartJs/Chart.min.js"></script>

    <!-- Toastr -->
    <script src="js/plugins/toastr/toastr.min.js"></script>
    <!-- Flot demo data -->
    <script src="js/demo/flot-demo.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script type="text/javascript">

      var socket = io()
      socket.emit('initializate', 1);
      socket.on('initializate', function(data){
          console.log(data);
          if(data.active==false){
            $('#detener').hide();
            $('#iniciar').show();
          }else{
            $('#detener').show();
            $('#iniciar').hide();
          }
            $('.num1').html(data.totalReg);
            $('.num2').html(data.poblados);
            $('.num3').html(data.gacela);
            $('.num4').html(data.nogacela);
            $('.datoErrores').html(data.errores);
            $('.datoInicio').html(data.fechaInicio);
            $('.datoTrabajo').html(data.trabajo);
            $('.datoPromedio').html(data.promedio);
      });

      socket.on('reset', function(data){
        socket.emit('initializate', 1);
      })
      socket.on('cantidadP', function(data){
        $('.num1').html(data);
      })
      socket.on('totalPoblado', function(data){
        $('.num2').html(data);
      })
      socket.on('siGacela', function(data){
        $('.num3').html(data);
      })
      socket.on('noGacela', function(data){
        $('.num4').html(data);
      })

      socket.on('datoInicio', function(data){
        $('.datoInicio').html(data);
      })

      socket.on('datoTrabajo', function(data){
        $('.datoTrabajo').html(data);
      })

      socket.on('datoErrores', function(data){
        $('.datoErrores').html(data);
      })

      socket.on('datoPromedio', function(data){
        $('.datoPromedio').html(data);
      })

      socket.on('min', function(num){
        $('.sidebar-list').prepend(num);
      })

      socket.on('nuevoError', function(data){
        $('#error_list').prepend(data.data);
      })

      socket.on('addReg', function(data){
        $('#reg_list').prepend(data.html);
      })
      socket.on('cant_ej', function(data){
        $('.cant_ej').html(data);
      })
      
      

      socket.on('activarApagado', function(data){
        if(data){
            $('#detener').show('slow');
            $('#iniciar').hide('slow');
        }else{
            $('#iniciar').show('slow');
            $('#detener').hide('slow');
        }
      })


      

      $('#iniciar').click(function(){
        $(this).hide('slow');
        var activar = 1;
        socket.emit('activar', activar);
      })

      $('#detener').click(function(){
        $(this).hide('slow');
        var desactivar = 0;
        socket.emit('desactivar', desactivar);
      })


      $(function() {

var container = $("#flot-line-chart-moving");

// Determine how many data points to keep based on the placeholder's initial size;
// this gives us a nice high-res plot while avoiding more than one point per pixel.

var maximum = container.outerWidth() / 2 || 300;



var data = [];

function getRandomData() {

        if (data.length) {
            data = data.slice(1);
        }

        while (data.length < maximum) {
            var previous = data.length ? data[data.length - 1] : 50;
            var y = 0;
            data.push(y < 0 ? 0 : y > 100 ? 100 : y);
        }

        // zip the generated y values with the x values

        var res = [];
        for (var i = 0; i < data.length; ++i) {
            res.push([i, 0])
        }

        return res;
    }

    function getData(data1) {
        // console.log(data1);
        // let promedio = (Number(data1.replace(/ seg\/reg/,""))*10)/3;
        // console.log(promedio);
        if (data.length) {
            data = data.slice(1);
        }

        while (data.length < maximum) {
            var previous = data.length ? data[data.length - 1] : 50;
            var y =Number(data1);
            data.push(y < 0 ? 0 : y > 100 ? 100 : y);
        }

        // zip the generated y values with the x values

        var res = [];
        for (var i = 0; i < data.length; ++i) {
            res.push([i, data[i]])
        }

        return res;
}

    series = [{
        data: getRandomData(),
        lines: {
            fill: true
        }
    }];


    var plot = $.plot(container, series, {
        grid: {

            color: "#999999",
            tickColor: "#D4D4D4",
            borderWidth:0,
            minBorderMargin: 20,
            labelMargin: 10,
            backgroundColor: {
                colors: ["#ffffff", "#ffffff"]
            },
            margin: {
                top: 8,
                bottom: 20,
                left: 20
            },
            markings: function(axes) {
                var markings = [];
                var xaxis = axes.xaxis;
                for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                    markings.push({
                        xaxis: {
                            from: x,
                            to: x + xaxis.tickSize
                        },
                        color: "#fff"
                    });
                }
                return markings;
            }
        },
        colors: ["#1ab394"],
        xaxis: {
            tickFormatter: function() {
                return "";
            }
        },
        yaxis: {
            min: 0,
            max: 30
        },
        legend: {
            show: true
        }
    });

    // Update the random dataset at 25FPS for a smoothly-animating chart
    socket.on("tiempoTomado",function updateRandom(data) {
        console.log(data);
        series[0].data = getData(data);
        plot.setData(series);
        plot.draw();
    });

});



    </script>
</body>

</html>